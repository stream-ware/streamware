# =============================================================================
# Streamware Configuration
# Copy this file to .env and customize as needed
# =============================================================================

# -----------------------------------------------------------------------------
# AI / LLM Settings
# -----------------------------------------------------------------------------
# Default AI model for vision analysis
# Fast: moondream (~300ms, less accurate), Balanced: llava:7b (~1.5s, good), Accurate: llava:13b (~3s, best)
# Install: ollama pull llava:7b
SQ_MODEL=llava:7b

# Ollama server URL
SQ_OLLAMA_URL=http://localhost:11434

# OpenAI API Key (for GPT models)
SQ_OPENAI_API_KEY=

# Anthropic API Key (for Claude models)
SQ_ANTHROPIC_API_KEY=

# Default LLM provider: ollama, openai, anthropic
SQ_LLM_PROVIDER=ollama

# Response validation with small LLM (reduces noise in logs)
# Fast: gemma:2b (~0.5-1s), Balanced: qwen2.5:3b (~1-2s)
# Install with: ollama pull gemma:2b
SQ_GUARDER_MODEL=gemma:2b
SQ_USE_GUARDER=true

# -----------------------------------------------------------------------------
# LLM Optimization Settings
# -----------------------------------------------------------------------------
# Skip LLM when YOLO confidence is high enough (saves 4-7 seconds per frame)
# 0.3 = aggressive skip (faster, may miss some), 0.5 = balanced, 1.0 = always use LLM
SQ_YOLO_SKIP_LLM_THRESHOLD=0.5

# Performance profiles:
# ULTRA_FAST: SQ_YOLO_SKIP_LLM_THRESHOLD=0.3, SQ_USE_GUARDER=false, SQ_MODEL=moondream
# FAST:       SQ_YOLO_SKIP_LLM_THRESHOLD=0.5, SQ_USE_GUARDER=false, SQ_MODEL=moondream  
# BALANCED:   SQ_YOLO_SKIP_LLM_THRESHOLD=0.5, SQ_USE_GUARDER=false, SQ_MODEL=llava:7b
# ACCURATE:   SQ_YOLO_SKIP_LLM_THRESHOLD=1.0, SQ_USE_GUARDER=true,  SQ_MODEL=llava:7b

# -----------------------------------------------------------------------------
# Stream Analysis Settings
# -----------------------------------------------------------------------------
# Default analysis mode: full, diff, track
# track = intelligent movement tracking (entering, exiting, direction)
# diff = only describe changes between frames
# full = describe everything in each frame
SQ_STREAM_MODE=track

# Default interval between frames (seconds)
SQ_STREAM_INTERVAL=3

# Default duration (seconds, 0=infinite)
SQ_STREAM_DURATION=30

# Default focus for detection: person, animal, vehicle, face, motion, package, intrusion
# For track mode: person is recommended for best movement analysis
SQ_STREAM_FOCUS=person

# Default sensitivity: low, medium, high
SQ_STREAM_SENSITIVITY=medium

# Save frames to this directory (empty = temp dir)
SQ_STREAM_FRAMES_DIR=

# -----------------------------------------------------------------------------
# Network Scanning Settings
# -----------------------------------------------------------------------------
# Default subnet to scan (empty = auto-detect)
SQ_NETWORK_SUBNET=

# Scan timeout (seconds)
SQ_NETWORK_TIMEOUT=10

# Enable deep scan by default
SQ_NETWORK_DEEP=false

# -----------------------------------------------------------------------------
# Camera / RTSP Defaults
# -----------------------------------------------------------------------------
# Default RTSP username
SQ_RTSP_USER=admin

# Default RTSP password
SQ_RTSP_PASS=admin

# Default RTSP port
SQ_RTSP_PORT=554

# -----------------------------------------------------------------------------
# Keyframe & Optimization Settings
# -----------------------------------------------------------------------------
# Enable keyframe extraction (only analyze changed frames)
SQ_USE_KEYFRAMES=true

# Scene change threshold (0.0-1.0, lower = more sensitive)
SQ_KEYFRAME_THRESHOLD=0.15

# Minimum seconds between keyframes
SQ_KEYFRAME_MIN_INTERVAL=1.0

# Maximum seconds without keyframe (force periodic analysis)
SQ_KEYFRAME_MAX_INTERVAL=10.0

# Enable adaptive scene classification
SQ_ADAPTIVE_SCENE=true

# Enable hierarchical LLM (fast model first, then accurate if needed)
SQ_HIERARCHICAL_LLM=false

# -----------------------------------------------------------------------------
# Image Optimization (for LLM vision processing)
# -----------------------------------------------------------------------------
# Preset: fast, balanced, quality, minimal
SQ_IMAGE_PRESET=balanced

# Maximum image dimension in pixels (width or height)
SQ_IMAGE_MAX_SIZE=512

# JPEG quality (1-100, lower = smaller file)
SQ_IMAGE_QUALITY=65

# Color posterization (0=off, 8-256=reduce to N colors)
SQ_IMAGE_POSTERIZE=0

# Convert to grayscale (reduces data but may hurt color detection)
SQ_IMAGE_GRAYSCALE=false

# -----------------------------------------------------------------------------
# Voice / STT-TTS Settings
# -----------------------------------------------------------------------------
# STT provider: google, whisper_local, whisper_api
SQ_STT_PROVIDER=whisper_local

# Whisper model (for whisper_local): tiny, base, small, medium, large
SQ_WHISPER_MODEL=base

# TTS engine: auto, pyttsx3, espeak, pico, festival, say (macOS), powershell (Windows)
SQ_TTS_ENGINE=auto

# Preferred voice (substring match, e.g., "polski", "English")
SQ_TTS_VOICE=

# Speech rate (words per minute)
SQ_TTS_RATE=150

# -----------------------------------------------------------------------------
# LLM Processing Settings
# -----------------------------------------------------------------------------
# LLM timeout in seconds
SQ_LLM_TIMEOUT=60

# Motion detection threshold (0-100, lower = more sensitive)
SQ_MOTION_THRESHOLD=25

# Minimum motion region size in pixels
SQ_MOTION_MIN_REGION=500

# Frame analysis downscale factor (0.1-1.0, lower = faster but less accurate)
SQ_FRAME_SCALE=0.3

# -----------------------------------------------------------------------------
# Fast Capture Settings (for live narrator optimization)
# -----------------------------------------------------------------------------
# Enable FastCapture for RTSP streams (10x faster than subprocess)
SQ_FAST_CAPTURE=true

# Capture backend: auto (prefers opencv), opencv, ffmpeg
SQ_CAPTURE_BACKEND=auto

# RAM disk path for fast frame storage
SQ_RAMDISK_PATH=/dev/shm/streamware
SQ_RAMDISK_ENABLED=true

# -----------------------------------------------------------------------------
# YOLO Detection Settings (auto-installed on first use)
# -----------------------------------------------------------------------------
# Enable YOLO for fast, accurate object detection
SQ_USE_YOLO=true

# YOLO model size (download size / speed / accuracy):
# yolov8n: 6MB, ~10ms GPU, fastest
# yolov8s: 22MB, ~20ms GPU, fast
# yolov8m: 52MB, ~40ms GPU, balanced
# yolov8l: 87MB, ~60ms GPU, accurate
# yolov8x: 131MB, ~100ms GPU, most accurate
SQ_YOLO_MODEL=yolov8n

# Minimum confidence for YOLO detections (0.0-1.0)
SQ_YOLO_CONFIDENCE=0.25

# Skip LLM if YOLO confidence >= this threshold (saves ~4-7s per frame)
# Set to 1.0 to always use LLM, set to 0.3 for faster detection
SQ_YOLO_SKIP_LLM_THRESHOLD=0.5

# -----------------------------------------------------------------------------
# Animal Detection Settings
# -----------------------------------------------------------------------------
# Focus type for animal detection:
# all: detect all animals (birds, cats, dogs, wildlife)
# bird: birds only (optimized for feeders)
# cat: cats only
# dog: dogs only
# pet: cats and dogs
# wildlife: horses, cows, sheep, bears, etc.
SQ_ANIMAL_FOCUS=all

# Minimum detection size (fraction of frame, 0.001 = 0.1%)
# Lower = more sensitive (can detect smaller animals)
# Birds need lower threshold (~0.001-0.003)
SQ_ANIMAL_MIN_SIZE=0.003

# -----------------------------------------------------------------------------
# Output Settings
# -----------------------------------------------------------------------------
# Default output format: yaml, json, table, html
SQ_OUTPUT_FORMAT=yaml

# Reports output directory
SQ_REPORTS_DIR=./reports

# Include base64 images in HTML reports
SQ_REPORT_INCLUDE_IMAGES=true

# -----------------------------------------------------------------------------
# Email Settings (for alerts)
# -----------------------------------------------------------------------------
SQ_SMTP_HOST=smtp.gmail.com
SQ_SMTP_PORT=587
SQ_SMTP_USER=
SQ_SMTP_PASS=
SQ_EMAIL_FROM=
SQ_EMAIL_TO=

# -----------------------------------------------------------------------------
# Slack Settings (for alerts)
# -----------------------------------------------------------------------------
SQ_SLACK_WEBHOOK=
SQ_SLACK_CHANNEL=alerts

# -----------------------------------------------------------------------------
# Telegram Settings (for alerts)
# -----------------------------------------------------------------------------
SQ_TELEGRAM_BOT_TOKEN=
SQ_TELEGRAM_CHAT_ID=

# -----------------------------------------------------------------------------
# Database Settings
# -----------------------------------------------------------------------------
SQ_POSTGRES_HOST=localhost
SQ_POSTGRES_PORT=5432
SQ_POSTGRES_USER=postgres
SQ_POSTGRES_PASS=
SQ_POSTGRES_DB=streamware

# -----------------------------------------------------------------------------
# Kafka Settings
# -----------------------------------------------------------------------------
SQ_KAFKA_BROKERS=localhost:9092
SQ_KAFKA_GROUP_ID=streamware

# -----------------------------------------------------------------------------
# SSH Defaults
# -----------------------------------------------------------------------------
SQ_SSH_USER=
SQ_SSH_KEY=~/.ssh/id_rsa
SQ_SSH_PORT=22

# -----------------------------------------------------------------------------
# Web UI Settings
# -----------------------------------------------------------------------------
SQ_WEB_HOST=0.0.0.0
SQ_WEB_PORT=8080
SQ_WEB_DEBUG=false

# -----------------------------------------------------------------------------
# Logging
# -----------------------------------------------------------------------------
SQ_LOG_LEVEL=INFO
SQ_LOG_FILE=
SQ_LLM_MIN_MOTION_PERCENT=30


# Vision Model Parameters
SQ_VISION_MODELS=llava,moondream,bakllava,llava-llama3,minicpm-v
SQ_VISION_TIMEOUT=10
SQ_VISION_TIMEOUT_LONG=12
SQ_VISION_SUMMARY_MAX_LENGTH=80
SQ_VISION_ASSUME_PRESENT=0.5
SQ_VISION_CONFIDENT_PRESENT=0.9
SQ_VISION_CONFIDENT_ABSENT=0.9

# Guarder Model Parameters
SQ_GUARDER_TIMEOUT=8
SQ_GUARDER_DEFAULT_MODEL=qwen2.5:3b
SQ_GUARDER_MAX_RESPONSE_LENGTH=200
# Note: Small models list moved to SQ_SMALL_MODELS (centralized LLM config)

# Adaptive Throttling (If processing > threshold, throttle to interval from FPS)
SQ_SLOW_PROCESSING_THRESHOLD=1.0
# Note: throttle_interval is auto-calculated from SQ_STREAM_INTERVAL

# Motion Analysis Parameters
SQ_MOTION_ANALYSIS_FPS=1.0
SQ_MOTION_ANALYSIS_THUMBNAIL_SIZE=192
SQ_MOTION_ANALYSIS_THUMBNAIL_QUALITY=75
SQ_MOTION_ANALYSIS_INCLUDE_SKIPPED=true
SQ_MOTION_ANALYSIS_THRESHOLD=25
SQ_MOTION_ANALYSIS_MIN_AREA=500
SQ_MOTION_ANALYSIS_GRID_SIZE=8
SQ_MOTION_ANALYSIS_CELL_THRESHOLD=0.1
SQ_MOTION_ANALYSIS_EDGE_THRESHOLD=50
SQ_MOTION_ANALYSIS_VERTICAL_THRESHOLD=0.3
SQ_MOTION_ANALYSIS_UPPER_PERCENT=0.6
SQ_MOTION_ANALYSIS_MIN_MOTION=0.5
SQ_MOTION_ANALYSIS_MAX_MOTION=15.0
SQ_MOTION_ANALYSIS_MIN_REGIONS=2
SQ_MOTION_ANALYSIS_MAX_REGIONS=8
SQ_MOTION_ANALYSIS_MIN_SPREAD=0.1
SQ_MOTION_ANALYSIS_MAX_SPREAD_X=0.5
SQ_MOTION_ANALYSIS_MAX_SPREAD_Y=0.6
SQ_MOTION_ANALYSIS_CONFIDENCE_THRESHOLD=0.5

# Tracking Settings
SQ_TRACK_MIN_STABLE_FRAMES=3
SQ_TRACK_BUFFER=90
SQ_TRACK_ACTIVATION_THRESHOLD=0.25
SQ_TRACK_MATCHING_THRESHOLD=0.8

# Object Re-Identification (ReID) - recognize same object across frames
# Uses OSNet/ResNet18 features to match objects after occlusion
SQ_USE_REID=true
SQ_REID_THRESHOLD=0.4
SQ_REID_GALLERY_SIZE=10


# Concurrent Processing (async frame analysis)
SQ_CONCURRENT_WORKERS=2
SQ_CONCURRENT_MODE=true

# -----------------------------------------------------------------------------
# Live Narrator Settings
# -----------------------------------------------------------------------------
# Force LLM check every N frames even without motion (detect static objects)
SQ_FORCE_LLM_INTERVAL=10

# Motion threshold below which to skip LLM (0.0-1.0, lower = more sensitive)
SQ_SKIP_MOTION_THRESHOLD=0.5

# -----------------------------------------------------------------------------
# Intelligent Notification Filter (LLM-based)
# -----------------------------------------------------------------------------
# Enable LLM-based notification filtering (instead of simple heuristics)
SQ_NOTIFICATION_FILTER_ENABLED=true

# Model for notification decisions (fast, small model recommended)
# Options: qwen2.5:3b, gemma:2b, phi3:mini, llama3.2:1b
SQ_NOTIFICATION_FILTER_MODEL=qwen2.5:3b

# Timeout for notification filter LLM calls (seconds)
SQ_NOTIFICATION_FILTER_TIMEOUT=10

# -----------------------------------------------------------------------------
# LLM Models Configuration (centralized)
# -----------------------------------------------------------------------------
# Main vision model for image analysis
SQ_VISION_MODEL=llava:7b

# Fast guarder model for response validation
SQ_GUARDER_MODEL=gemma:2b

# Decision/filter model (notifications, intent)
SQ_DECISION_MODEL=qwen2.5:3b

# Text generation model (summaries, descriptions)
SQ_TEXT_MODEL=llama3.2:latest

# Code generation model
SQ_CODE_MODEL=qwen2.5-coder:7b

# Fallback models list (comma-separated, tried in order if primary fails)
# Used for: notification filter, guarder, response validation
SQ_FALLBACK_MODELS=qwen2.5:7b,gemma:2b,llama3.2:latest,phi3:mini

# Small/fast models for quick decisions (comma-separated)
SQ_SMALL_MODELS=gemma:2b,phi3:mini,llama3.2:1b,qwen2.5:3b,deepseek-r1:1.5b

# -----------------------------------------------------------------------------
# Voice Shell Settings
# -----------------------------------------------------------------------------
# Default WebSocket port for voice shell
SQ_VOICE_SHELL_PORT=8765

# Default language for voice shell: en, pl, de
SQ_VOICE_SHELL_LANG=en

# Email notification address (saved persistently)
SQ_NOTIFY_EMAIL=

# Default video URL for voice commands
SQ_DEFAULT_URL=